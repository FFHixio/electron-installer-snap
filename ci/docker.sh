#!/bin/bash

cd /code

# Pre-install dependencies installed by snapcraft
apt install --no-install-recommends -y autotools-dev bsdmainutils build-essential bzip2 debhelper dh-strip-nondeterminism dpkg-dev file fontconfig fontconfig-config fonts-dejavu-core gettext gettext-base gir1.2-atk-1.0 gir1.2-freedesktop gir1.2-gdkpixbuf-2.0 gir1.2-gtk-2.0 gir1.2-pango-1.0 groff-base hicolor-icon-theme intltool-debian libalgorithm-diff-perl libalgorithm-diff-xs-perl libalgorithm-merge-perl libarchive-zip-perl libasprintf-dev libasprintf0v5 libatk1.0-0 libatk1.0-data libatk1.0-dev libavahi-client3 libavahi-common-data libavahi-common3 libcairo-gobject2 libcairo-script-interpreter2 libcairo2 libcairo2-dev libcroco3 libcups2 libdatrie1 libdpkg-perl libexpat1-dev libfile-fcntllock-perl libfile-stripnondeterminism-perl libfontconfig1 libfontconfig1-dev libfreetype6 libfreetype6-dev libgdk-pixbuf2.0-dev libgettextpo-dev libgettextpo0 libglib2.0-bin libglib2.0-data libglib2.0-dev libgraphite2-3 libgtk2.0-0 libgtk2.0-bin libgtk2.0-common libgtk2.0-dev libharfbuzz-dev libharfbuzz-gobject0 libharfbuzz-icu0 libharfbuzz0b libice-dev libice6 libmail-sendmail-perl libpango-1.0-0 libpango1.0-dev libpangocairo-1.0-0 libpangoft2-1.0-0 libpangoxft-1.0-0 libpcre16-3 libpcre3-dev libpcre32-3 libpcrecpp0v5 libpipeline1 libpixman-1-0 libpixman-1-dev libpng12-dev libpthread-stubs0-dev libsm-dev libsm6 libsys-hostname-long-perl libthai-data libthai0 libtimedate-perl libunistring0 libx11-dev libx11-doc libxau-dev libxcb-render0 libxcb-render0-dev libxcb-shm0 libxcb-shm0-dev libxcb1-dev libxcomposite-dev libxcomposite1 libxcursor-dev libxcursor1 libxdamage-dev libxdamage1 libxdmcp-dev libxext-dev libxext6 libxfixes-dev libxfixes3 libxft-dev libxft2 libxi-dev libxi6 libxinerama-dev libxinerama1 libxml2-utils libxrandr-dev libxrandr2 libxrender-dev libxrender1 man-db patch pkg-config po-debconf shared-mime-info ucf x11-common x11proto-composite-dev x11proto-core-dev x11proto-damage-dev x11proto-fixes-dev x11proto-input-dev x11proto-kb-dev x11proto-randr-dev x11proto-render-dev x11proto-xext-dev x11proto-xinerama-dev xorg-sgml-doctools xtrans-dev xz-utils zlib1g-dev
DEBUG='electron-installer-snap:*' CI=true npm run coverage
